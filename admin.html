<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Super Admin Dashboard</title>
  <script type="module" src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script type="module" src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
  <script type="module" src="firebase-config.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f4f8;
      padding: 20px;
    }
    h1 {
      color: #0077b6;
      text-align: center;
    }
    .filters {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      justify-content: center;
    }
    select {
      padding: 10px;
      font-size: 16px;
    }
    .record {
      background: white;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .record img {
      max-width: 100px;
      display: block;
      margin-top: 10px;
    }
    #showPasswordButton {
      background-color: #f1f1f1;
      color: #0077b6;
      border: 1px solid #0077b6;
      width: auto;
      padding: 5px 10px;
      cursor: pointer;
      margin-top: 10px;
    }
    #showPasswordButton:hover {
      background-color: #cce6ff;
    }
    .login-form {
      max-width: 400px;
      margin: 50px auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      text-align: center;
    }
    .login-form input, .login-form button {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      font-size: 16px;
    }
    .button {
      background-color: #0077b6;
      color: white;
      border: none;
      cursor: pointer;
    }
    .button:hover {
      background-color: #005f80;
    }
  </style>
</head>
<body>
  <div class="login-form" id="loginForm">
    <h2>Login</h2>
    <input type="text" id="username" placeholder="Username" required />
    <input type="password" id="password" placeholder="Password" required />
    <button id="showPasswordButton" type="button">Show Password</button>
    <br />
    <button class="button" id="loginBtn">Login</button>
    <p id="errorMessage" style="color: red; display: none;">Invalid username or password</p>
  </div>

  <div id="dashboard" style="display:none">
    <h1>Super Admin Dashboard</h1>
    <div class="filters">
      <select id="userTypeFilter">
        <option value="staff">Staff</option>
        <option value="student">Student</option>
        <option value="guest">Guest</option>
      </select>
      <select id="timeStatusFilter">
        <option value="all">All</option>
        <option value="Time In">Time In</option>
        <option value="Time Out">Time Out</option>
      </select>
    </div>
    <div id="recordsContainer"></div>
  </div>

  <script type="module">
    import { app, db } from "./firebase-config.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

    const dbRef = getDatabase();

    document.getElementById("loginBtn").addEventListener("click", () => {
      const username = document.getElementById("username").value;
      const password = document.getElementById("password").value;

      const accRef = ref(dbRef, "accounts/admin");
      onValue(accRef, (snapshot) => {
        const data = snapshot.val();
        if (data && data.u_name === username && data.p_word === password) {
          document.getElementById("loginForm").style.display = "none";
          document.getElementById("dashboard").style.display = "block";
          loadRecords();
        } else {
          document.getElementById("errorMessage").style.display = "block";
        }
      }, {
        onlyOnce: true
      });
    });

    document.getElementById("showPasswordButton").addEventListener("click", () => {
      const passwordInput = document.getElementById("password");
      const button = document.getElementById("showPasswordButton");
      if (passwordInput.type === "password") {
        passwordInput.type = "text";
        button.textContent = "Hide Password";
      } else {
        passwordInput.type = "password";
        button.textContent = "Show Password";
      }
    });

    document.getElementById("userTypeFilter").addEventListener("change", loadRecords);
    document.getElementById("timeStatusFilter").addEventListener("change", loadRecords);

    function loadRecords() {
      const userType = document.getElementById("userTypeFilter").value;
      const timeStatusFilter = document.getElementById("timeStatusFilter").value;
      const container = document.getElementById("recordsContainer");
      container.innerHTML = "Loading...";

      const recordsRef = ref(dbRef, userType);
      onValue(recordsRef, (snapshot) => {
        const data = snapshot.val();
        container.innerHTML = "";
        if (data) {
          Object.values(data).forEach((entry) => {
            if (timeStatusFilter === "all" || entry.timeStatus === timeStatusFilter) {
              const recordDiv = document.createElement("div");
              recordDiv.className = "record";
              recordDiv.innerHTML = `
                <strong>Name:</strong> ${entry.firstname} ${entry.middlename || ""} ${entry.lastname} ${entry.nameext || ""}<br>
                <strong>Email:</strong> ${entry.email}<br>
                <strong>Room:</strong> ${entry.room}<br>
                <strong>Floor:</strong> ${entry.floor}<br>
                <strong>Time Status:</strong> ${entry.timeStatus}<br>
                <strong>Purpose:</strong> ${entry.purpose}<br>
                <strong>Timestamp:</strong> ${entry.timestamp}<br>
                ${entry.validID ? `<img src="${entry.validID}" alt="Valid ID" />` : ""}
              `;
              container.appendChild(recordDiv);
            }
          });
        } else {
          container.innerHTML = "No records found.";
        }
      });
    }
  </script>
</body>
</html>
