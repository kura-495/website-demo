<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>F</title>
  <script type="module" src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script type="module" src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
  <script type="module" src="firebase-config.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #e0f7ff;
      padding: 20px;
      text-align: center;
    }

    h1 {
      color: #0077b6;
    }

    .hidden {
      display: none;
    }

    .form-container {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      max-width: 400px;
      margin: auto;
    }

    input, select, textarea, button {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      font-size: 16px;
      border-radius: 5px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }

    .button {
      background-color: #0096c7;
      color: white;
      border: none;
      cursor: pointer;
    }

    .button:hover {
      background-color: #005f80;
    }

    #showPasswordButton {
      background-color: #f1f1f1;
      color: #0077b6;
      border: 1px solid #0077b6;
      width: auto;
      padding: 5px 10px;
      cursor: pointer;
      margin-top: 10px;
    }

    #showPasswordButton:hover {
      background-color: #cce6ff;
    }

    .filters {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      justify-content: center;
    }

    .record {
      background: white;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      text-align: left;
      max-width: 800px;
      margin: 10px auto;
    }

    .record img {
      max-width: 100px;
      display: block;
      margin-top: 10px;
    }
  </style>
</head>
<body>

  <!-- Login Section -->
  <div class="form-container" id="loginSection">
    <h1>Admin Login</h1>
    <input type="text" id="username" placeholder="Username" required />
    <input type="password" id="password" placeholder="Password" required />
    <button id="showPasswordButton">Show Password</button>
    <button class="button" onclick="login()">Login</button>
  </div>

  <!-- Dashboard Section -->
  <div id="dashboardSection" style="display: none;">
    <h1>Admin Dashboard</h1>

    <div class="filters">
      <select id="userTypeFilter">
        <option value="all">All Users</option>
        <option value="staff">Staff</option>
        <option value="student">Student</option>
        <option value="guest">Guest</option>
      </select>

      <select id="timeStatusFilter">
        <option value="all">All Status</option>
        <option value="Time In">Time In</option>
        <option value="Time Out">Time Out</option>
      </select>

      <select id="yearFilter">
        <option value="all">All Years</option>
        <!-- Year options will be populated dynamically -->
      </select>

      <select id="monthFilter" disabled>
        <option value="all">All Months</option>
        <!-- Month options will be populated dynamically -->
      </select>

      <button id="todayButton" class="button">Today</button>
      <button id="allButton" class="button">All</button>

      <select id="floorFilter">
        <option value="all">All Floors</option>
        <option value="1">Floor 1</option>
        <option value="2">Floor 2</option>
      </select>
    </div>

    <div id="recordsContainer"></div>
  </div>

 <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";

// Your Firebase config
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_AUTH_DOMAIN",
  databaseURL: "YOUR_DB_URL",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_BUCKET",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// DOM elements
const userTypeFilter = document.getElementById('userType');
const timeStatusFilter = document.getElementById('timeStatus');
const yearFilter = document.getElementById('year');
const monthFilter = document.getElementById('month');
const floorFilter = document.getElementById('floor');
const todayButton = document.getElementById('today');
const allButton = document.getElementById('all');
const recordsContainer = document.getElementById('records');

userTypeFilter.addEventListener('change', fetchData);
timeStatusFilter.addEventListener('change', fetchData);
yearFilter.addEventListener('change', fetchData);
monthFilter.addEventListener('change', fetchData);
floorFilter.addEventListener('change', fetchData);

todayButton.addEventListener('click', () => {
  const today = new Date().toISOString().split('T')[0];
  yearFilter.disabled = true;
  monthFilter.disabled = true;
  fetchTodayOnly(today);
});

allButton.addEventListener('click', () => {
  yearFilter.disabled = false;
  yearFilter.value = 'all';
  monthFilter.value = 'all';
  fetchData();
});

async function fetchData() {
  recordsContainer.innerHTML = '';
  const selectedUser = userTypeFilter.value;
  const selectedStatus = timeStatusFilter.value;
  const selectedYear = yearFilter.value;
  const selectedMonth = monthFilter.value;
  const selectedFloor = floorFilter.value;

  const types = selectedUser === 'all' ? ['staff', 'student', 'guest'] : [selectedUser];
  const snapshot = await get(ref(db));
  if (!snapshot.exists()) return;

  const data = snapshot.val();
  const allEntries = [];

  types.forEach(type => {
    if (data[type]) {
      Object.values(data[type]).forEach(entry => {
        entry._type = type;
        allEntries.push(entry);
      });
    }
  });

  // Extract available years
  const years = Array.from(new Set(
    allEntries.map(entry => new Date(entry.timestamp).getFullYear())
  )).sort((a, b) => b - a);

  // Populate Year filter
  yearFilter.innerHTML = '<option value="all">All Years</option>';
  years.forEach(year => {
    const option = document.createElement('option');
    option.value = year;
    option.textContent = year;
    yearFilter.appendChild(option);
  });

  // Handle Month filter
  if (selectedYear !== 'all') {
    monthFilter.disabled = false;
    const months = Array.from(new Set(
      allEntries
        .filter(e => new Date(e.timestamp).getFullYear() === Number(selectedYear))
        .map(e => new Date(e.timestamp).getMonth() + 1)
    )).sort((a, b) => a - b);

    monthFilter.innerHTML = '<option value="all">All Months</option>';
    months.forEach(month => {
      const option = document.createElement('option');
      option.value = month;
      option.textContent = month;
      monthFilter.appendChild(option);
    });
  } else {
    monthFilter.disabled = true;
    monthFilter.innerHTML = '<option value="all">All Months</option>';
  }

  // Filter entries
  const filtered = allEntries.filter(entry => {
    const date = new Date(entry.timestamp);
    const year = date.getFullYear();
    const month = date.getMonth() + 1;

    if (selectedYear !== 'all' && year !== Number(selectedYear)) return false;
    if (selectedMonth !== 'all' && selectedYear !== 'all' && month !== Number(selectedMonth)) return false;
    if (selectedStatus !== 'all' && entry.timeStatus !== selectedStatus) return false;
    if (selectedFloor !== 'all' && entry.floor !== selectedFloor) return false;

    return true;
  });

  displayRecords(filtered);
}

function fetchTodayOnly(todayStr) {
  get(ref(db)).then(snapshot => {
    if (!snapshot.exists()) return;

    const data = snapshot.val();
    const types = ['staff', 'student', 'guest'];
    const allEntries = [];

    types.forEach(type => {
      if (data[type]) {
        Object.values(data[type]).forEach(entry => {
          entry._type = type;
          allEntries.push(entry);
        });
      }
    });

    const filtered = allEntries.filter(entry => {
      const date = new Date(entry.timestamp).toISOString().split('T')[0];
      return date === todayStr;
    });

    displayRecords(filtered);
  });
}

function displayRecords(entries) {
  recordsContainer.innerHTML = '';
  if (entries.length === 0) {
    recordsContainer.innerHTML = '<p>No records found.</p>';
    return;
  }

  entries.forEach(entry => {
    const timestamp = new Date(entry.timestamp).toLocaleString();
    const recordDiv = document.createElement('div');
    recordDiv.className = 'record';
    recordDiv.innerHTML = `
      <strong>User Type:</strong> ${entry._type}<br>
      <strong>Email:</strong> ${entry.email || 'N/A'}<br>
      <strong>Name:</strong> ${entry.firstname || ''} ${entry.middlename || ''} ${entry.lastname || ''} ${entry.nameext || ''}<br>
      <strong>Time Status:</strong> ${entry.timeStatus || 'N/A'}<br>
      <strong>Room:</strong> ${entry.room || 'N/A'}<br>
      <strong>Floor:</strong> ${entry.floor || 'N/A'}<br>
      <strong>Purpose:</strong> ${entry.purpose || 'N/A'}<br>
      <strong>Timestamp:</strong> ${timestamp}<br>
    `;
    recordsContainer.appendChild(recordDiv);
  });
}

// Initial load
fetchData();
</script>
</body>
</html>
